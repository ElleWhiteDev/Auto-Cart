{% extends 'base.html' %}

{% block title %}{{ household.name }} - Settings{% endblock %}

{% block content %}
<div class="row">
	<div class="col-12">
		<h1><i class="fas fa-home"></i> {{ household.name }}</h1>
		<p class="text-muted">Manage your household members and settings</p>
	</div>
</div>

<div class="row mt-4">
	<!-- Household Members -->
	<div class="col-md-6">
		<div class="card">
			<div class="card-header">
				<h3 class="h5 mb-0"><i class="fas fa-users"></i> Household Members</h3>
			</div>
			<div class="card-body">
				<ul class="list-unstyled">
					{% for member in members %}
					<li class="flex justify-between items-center mb-3 pb-3" style="border-bottom: 1px solid #e9ecef;">
						<div>
							<strong>
								<i class="fas fa-user"></i> {{ member.user.username }}
							</strong>
							{% if member.role == 'owner' %}
							<span class="badge badge-primary ml-2">Owner</span>
							{% endif %}
							{% if member.user.id == g.user.id %}
							<span class="badge badge-secondary ml-2">You</span>
							{% endif %}
						</div>
						{% if is_owner and member.user.id != g.user.id %}
						<form method="POST" action="{{ url_for('remove_household_member', user_id=member.user.id) }}" style="display: inline;">
							<button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Remove {{ member.user.username }} from household?')">
								<i class="fas fa-times"></i> Remove
							</button>
						</form>
						{% endif %}
					</li>
					{% endfor %}
				</ul>

				{% if is_owner %}
				<div class="mt-4 pt-3" style="border-top: 1px solid #e9ecef;">
					<h4 class="h6 mb-3"><i class="fas fa-user-plus"></i> Invite Member</h4>
					<form method="POST" action="{{ url_for('invite_household_member') }}" class="flex gap-2">
						<input 
							type="text" 
							class="form-control" 
							name="username" 
							placeholder="Enter username"
							required
						/>
						<button type="submit" class="btn btn-primary">
							<i class="fas fa-plus"></i> Invite
						</button>
					</form>
					<small class="form-text text-muted mt-2">
						Enter the username of an existing Auto Cart user to invite them.
					</small>
				</div>
				{% endif %}
			</div>
		</div>
	</div>

	<!-- Kroger Integration -->
	<div class="col-md-6">
		<div class="card">
			<div class="card-header">
				<h3 class="h5 mb-0"><i class="fas fa-shopping-bag"></i> Kroger Integration</h3>
			</div>
			<div class="card-body">
				{% if kroger_user %}
				<div class="alert alert-success">
					<i class="fas fa-check-circle"></i> 
					<strong>Connected</strong><br>
					Using <strong>{{ kroger_user.username }}</strong>'s Kroger account for household shopping.
				</div>
				{% else %}
				<div class="alert alert-warning">
					<i class="fas fa-exclamation-triangle"></i> 
					<strong>Not Connected</strong><br>
					No Kroger account is set for this household.
				</div>
				{% endif %}

				{% if is_owner %}
				<div class="mt-3">
					<h4 class="h6 mb-3">Set Kroger Account</h4>
					<p class="text-muted small mb-3">
						Choose which household member's Kroger account to use for sending grocery lists to cart.
					</p>
					{% for member in members %}
					{% if member.user.oauth_token %}
					<form method="POST" action="{{ url_for('set_kroger_user', user_id=member.user.id) }}" class="mb-2">
						<button type="submit" class="btn btn-sm {% if kroger_user and kroger_user.id == member.user.id %}btn-success{% else %}btn-outline-primary{% endif %} w-100">
							{% if kroger_user and kroger_user.id == member.user.id %}
							<i class="fas fa-check"></i> 
							{% endif %}
							Use {{ member.user.username }}'s Kroger Account
						</button>
					</form>
					{% endif %}
					{% endfor %}
					
					{% if not members|selectattr('user.oauth_token')|list %}
					<p class="text-muted small mb-0">
						<i class="fas fa-info-circle"></i> No household members have connected their Kroger account yet.
					</p>
					{% endif %}
				</div>
				{% endif %}
			</div>
		</div>

		<!-- Household Info -->
		<div class="card mt-4">
			<div class="card-header">
				<h3 class="h5 mb-0"><i class="fas fa-info-circle"></i> Household Info</h3>
			</div>
			<div class="card-body">
				<p class="mb-2">
					<strong>Created:</strong> {{ household.created_at.strftime('%B %d, %Y') if household.created_at else 'N/A' }}
				</p>
				<p class="mb-2">
					<strong>Members:</strong> {{ members|length }}
				</p>
				<p class="mb-0">
					<strong>Your Role:</strong> 
					<span class="badge badge-{% if is_owner %}primary{% else %}secondary{% endif %}">
						{{ 'Owner' if is_owner else 'Member' }}
					</span>
				</p>
			</div>
		</div>
	</div>
</div>

<div class="row mt-4">
	<div class="col-12">
		<a href="{{ url_for('homepage') }}" class="btn btn-secondary">
			<i class="fas fa-arrow-left"></i> Back to Recipes
		</a>
	</div>
</div>
{% endblock %}

