<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>{% block title %}Auto Cart - Smart Grocery Shopping{% endblock %}</title>
		<meta name="description" content="Auto Cart helps you create smart grocery lists from your favorite recipes. Streamline your shopping experience with AI-powered ingredient consolidation.">

		<!-- Favicon -->
		<link rel="icon" type="image/svg+xml" href="/static/favicon.svg">

		<!-- Bootstrap CSS (minimal usage) -->
		<link
			rel="stylesheet"
			href="https://unpkg.com/bootstrap@5.3.0/dist/css/bootstrap-grid.min.css"
		/>

		<!-- Font Awesome Icons -->
		<link
			rel="stylesheet"
			href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
		/>

		<!-- Our Design System -->
		<link rel="stylesheet" href="/static/stylesheets/design-system.css?v=4" />
		<link rel="stylesheet" href="/static/stylesheets/style.css?v=4" />

		<!-- JavaScript -->
		<script src="/static/js/main.js" defer></script>
	</head>

	<body class="{% block body_class %}{% endblock %}">
		<!-- Navigation -->
		<nav class="navbar">
			<div class="container">
				<div class="flex justify-between items-center w-100">
					<a href="{{url_for('main.homepage')}}" class="navbar-brand">
						<i class="fas fa-shopping-cart mr-2"></i>Auto Cart
					</a>
					<div class="nav-right">
						{% if g.user is none %}
						<a class="nav-link" href="{{url_for('auth.login')}}">
							<i class="fas fa-sign-in-alt"></i> Login
						</a>
						<a class="nav-link" href="{{url_for('auth.register')}}">
							<i class="fas fa-user-plus"></i> Register
						</a>
						{% else %}
						{% if g.household %}
						<a class="nav-link" href="{{url_for('main.household_setup')}}">
							<i class="fas fa-home"></i> {{ g.household.name }}
						</a>
						<a class="nav-link" href="{{url_for('meal_plan.meal_plan')}}">
							<i class="fas fa-calendar-alt"></i> Meal Plan
						</a>
						{% endif %}
						<a class="nav-link" href="{{url_for('auth.profile')}}">
							<i class="fas fa-user"></i> {{ g.user.username }}
						</a>
						<a class="nav-link" href="#feedback-modal" id="feedback-modal-trigger">
							<i class="fas fa-comment-dots"></i> Feedback
						</a>
						<a class="nav-link" href="{{url_for('auth.logout')}}">
							<i class="fas fa-sign-out-alt"></i> Logout
						</a>
						{% endif %}
					</div>
				</div>
			</div>
		</nav>

		<!-- Main Content -->
		<main class="section-sm">
			<div class="container">
				<!-- Flash Messages -->
				{% for category, message in get_flashed_messages(with_categories=True) %}
				<div class="alert alert-{{ category }}">
					<i class="fas fa-{% if category == 'success' %}check-circle{% elif category == 'danger' %}exclamation-triangle{% elif category == 'warning' %}exclamation-circle{% else %}info-circle{% endif %}"></i>
					{{ message }}
				</div>
				{% endfor %}

				<!-- Page Content -->
				{% block content %}{% endblock %}
			</div>
		</main>

		<!-- Feedback Modal -->
		{% if g.user %}
		<div id="feedback-modal" class="modal-container">
			<div class="my-modal">
				<div class="modal-header">
					<h2 class="modal-title">
						<i class="fas fa-comment-dots text-primary mr-2"></i>Submit Feedback
					</h2>
					<a href="#modal-closed" class="close-modal">&times;</a>
				</div>
				<div class="modal-body">
					<p class="text-gray-600 mb-4">
						We'd love to hear your thoughts! Share your feedback, suggestions, or report any issues you've encountered.
					</p>
					<form method="POST" action="{{ url_for('main.submit_feedback') }}" id="feedback-form">
						<div class="form-group">
							<label for="feedback-type" class="form-label">Feedback Type</label>
							<select id="feedback-type" name="feedback_type" class="form-select" required>
								<option value="">Select a type...</option>
								<option value="bug">Bug Report</option>
								<option value="feature">Feature Request</option>
								<option value="improvement">Improvement Suggestion</option>
								<option value="general">General Feedback</option>
							</select>
						</div>
						<div class="form-group">
							<label for="feedback-message" class="form-label">Your Feedback</label>
							<textarea
								id="feedback-message"
								name="message"
								class="form-textarea"
								rows="6"
								placeholder="Tell us what's on your mind..."
								required
							></textarea>
						</div>
						<div class="modal-footer">
							<a href="#modal-closed" class="btn btn-secondary">Cancel</a>
							<button type="submit" class="btn btn-primary" id="feedback-submit-btn">
								<i class="fas fa-paper-plane mr-2"></i>Submit Feedback
							</button>
						</div>
					</form>
				</div>
			</div>
		</div>
		{% endif %}

		{% block scripts %}{% endblock %}

		<script>
		// Handle feedback form submission loading state
		document.addEventListener('DOMContentLoaded', function() {
			const feedbackForm = document.getElementById('feedback-form');
			const feedbackSubmitBtn = document.getElementById('feedback-submit-btn');

			if (feedbackForm && feedbackSubmitBtn) {
				feedbackForm.addEventListener('submit', function() {
					feedbackSubmitBtn.disabled = true;
					feedbackSubmitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Submitting...';
				});
			}
		});
		</script>
	</body>
</html>
